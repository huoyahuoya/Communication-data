4G核心网与IMS有什么区别：
一切要重头说起，从电话技术发明
(1)到大哥大（1G移动通讯）诞生
(2)发展到2G数字移动通讯（GSM、CDMA）
(3)以及现在的3G（WCDMA、TD-SCDMA、CDMA-2000）
(4)4G（TD-LTE、FDD-LTE）
结：本质上是追求成本的降低，产品功能的多样化！

1G很简单，就是为了让固定电话能随身携带，没有额外功能，纯粹的模拟电话信号通过无线电传输；
2G以及后面的2.5G, 2.75G，是把模拟的电话信号转换成了数字化的编码，简单些理解就是家里无绳电话的模拟无线和2.4G数字无绳的区别，然后附带着，就象在电话线上提供猫拨号上网一样，提供了GPRS、EDGE的上线功能，当然，和猫上网一样，速度慢是典型的特点，这一时期还提供了象短信、彩信等一些有限的增值服务；
3G的重点放在了上网速度上，语音电话弱化了，但其本质是在2G上发展而来的，大量的科学家的精力花在了如何在旧体系上，有没有办法多压榨些资源来传输上网数据——这有点象把一个书架上的放书的格子和位置好好规范了一下，比随便乱放能放更多书了，但根本问题没解决，有限的通讯资源要保留着随时准备让语音电话使用，所以成本还是居高不下；
4G其实对普通用户意义不大，真正商用能稳定提供的下行带宽也就10M左右，与联通WCDMA宣传的3G的速度差别不大，虽然4G理论上能提供的速度能达到100M，但理论就只是理论，而已。
之前有过一篇文章说到过，4G之所以在用户需求层面没有动力时，运营商仍要大力去推，这好象有些不符合商业规律——技术本应该是根据市场用户需求而诞生的，但根源，是因为4G改变了从2G到3G时的运营商网络的建设方式和运营成本，4G不再保留 无线通讯资源来专门跑语音了，而是所有资源全部用来跑数据——就是全部用来上网；

▽
打电话时，走2G、3G线路上的语音保留资源，这是“独占”的资源，而4G所有的资源，都用来跑数据，电话语音也变成数据，大家可以“共享”网络带宽速率，显而易见，共享的资源的成本，肯定要大大低于独占的资源了，所以4G的数据资费，成本会远远低于3G时的上网成本，当然，这是对于运营商有利的，最终定什么价，还是运营商定；
虽然我们这里主要是说4G——也就是手机、移动通讯，但固定电话和固定宽带，技术上也是有相似性的，和上面移动通讯要发展1G、2G、3G、4G一样，固定电话和固定宽带也在从电话线——电话线+拨号上网——电话线+ADSL上网——纯光纤上网（送终端设备，从光纤上面接电话出来），几乎是和移动通讯类似的发展轨迹。
不管是4G的最终发展目标，还是光纤上网整合宽带上网和固定电话，他们都有一个统称，NGN下一代网络，美好的规范图是这样描绘的——在一个网络（NGN）上，同时能提供上网、电话、电视以及各种增值服务，三网融合。
手机移动通讯要实现这些美好愿景，在可以预见的未来，不太容易实现，特别是第一阶段，能让大家用习惯了的电话，顺顺当当跑在4G网络上，就是一项艰巨的任务，所以，3G会在相当长的时间里，和4G是共存的，并且4G更长一段时间，可能只是用来提供数据服务，因为—VoLTE还不成熟；
目前市面上的4G手机，都只是用4G来上网，而打电话仍走原来的3G或2G的通道，因为4G要想独立打电话，需要有IMS服务器和IMS软件终端，但无论是IMS服务器的成熟度和软件的终端的成熟度，还不够成熟，所以中国移动要采购的第一批产品中的MIFI和CPE，MIFI称为能提供4G接入的无线路由器的理解没错，而对CPE的名词解释，很多家专业媒体都说错了，CPE是在MIFI基础上，还留有一个模拟电话的接口，接上电话机就能打电话，而电话就是走的IMS服务器，真正的VoLTE，这算是移动用来试水的举措吧，用来测试IMS服务器的，稳定了才在手机上跑VoLTE。
VoIP
上面我们提到多个通讯行业的国际标准化组织，他们这么多年做的大量工作，就是为了让4G这个纯IP网络化的移动通讯网络，能让语音在共享的数据网络上（PS，即包交换），能象从前在独占的语音网络上（CS，即电路交换）跑的一样遛，他们想到了VoIP。
VoIP里面有许多标准，Skype是私有的，H323是通讯行业的标准，SIP是IETF也就是互联网组织定的，为什么通讯行业定未来下一个几十年的标准时，不是从他们自己的H323上面发展，而是选互联网行业标准组织IETF提出的SIP标准呢？大家都笑而不语……
但互联网的原则是开放，还有一个就是免费，所以SIP在脱离于通讯行业标准约束时，非常自由，对于不同供应商提供的SIP服务之间的结算啊、费用啊之类的没有通讯行业那么细——说白了，就是SIP提供的许多服务都是免费的，要想收费不太好下手，由此，3GPP等等一众通讯行业的标准化组织，在SIP基础上，提出了IMS，到此，我们标题里说的SIP、VoIP、VoLTE、IMS这些名词全部出场了。
VoIP解释起来简单，就是Voice on IP，语音跑在IP网络上，就是VoIP，这是一个比较上层的统称的名词，那么同样的VoLTE也只是说语音跑在LTE网络上——LTE就是指的4G的两个标准，TD-LTE、FDD-LTE——需要注意的是，TD-LTE和TD-SCDMA没有任何关系，其它的我就不多说了。
LTE全称是Long Time Evolution，从名字上就知道，4G这个东西提出的很匆忙，许多东西还没定好就被运营商急着要上线。
▽
IMS
而IMS这个东西就要复杂的多了，虽然SIP很好理解，大家暗地里可能也用了好多年的VoIP，对SIP也很熟悉了，它本质上就是一个服务器，放账号，大家注册上去就能打电话，很简单吧，但要收费呢，目前VoIP一般也只提供了便宜的网络电话，按时长或者包月收费，没有增值服务——这对于移动通讯运营商来说可是不能忍受的。
来电显示为什么不能收费？为什么彩铃不能收费？为什么留言不能收费？为什么为什么？
所以，IMS干的第一件是，就是加入了一个HSS子服务（Home Subscriber Server），这个是什么东西呢？SIP虽然也分为注册服务器Register Server、呼叫代理服务器Proxy Server，但SIP的注册服务器只是记录一下一个SIP账号的当前的IP地址数据、认证一下账号密码是不是正确；但IMS里的HSS就不简单了，他是在SIP的注册服务器基础上，增加了一个很明显的运营商特征——业务订购数据库，也就是在移动开手机卡时，那一堆附加增值服务，好了，你在这里可以看到来电显示业务、呼叫等待业务、彩铃业务……，的开关——也意味着收费的计费点；
因为VoIP很简单，一般是企业内部用，或者小规模的虚拟运营商在有限的几台服务器上提供服务，所以VoIP的SIP软件、SIP电话机网关就可以直接通过IP地址和账号就能注册上去，然后呼叫在多台服务器上互相路由就可以完成呼叫的目的了，这些服务器，一般就是SIP Proxy Server，涉及到和固定电话、手机号码互通时，会有FXO网关，E1网关等负责转换，这里不多说了。
而IMS作为运营商的方案，动辄上亿用户规模，而且又分为各省市地分公司，当然，还有一个不得不提的，漫游——IP还区分漫游？VoIP不是宣传不区分本地长途，没有漫游的概念么？是的，但IMS认为这样不行，所以，他要加入漫游的概念……
▽
SIP
IMS的核心是SIP，所以类似SIP Proxy Server这么重要的核心组件，IMS是不会少的，IMS里称它为Call Session Control Function，即CSCF，并且又把它分成了多个子系统，其中代理CSCF（P-CSCF）从用户终端角度看，基本就是SIP里的Proxy Server了（但其实不是，下述），负责直接与IMS的终端（类似SIP的软电话、硬件电话等等，但同样的，也扩展了不少东西，这里跳过不述）；P-CSCF直接与终端交互，可能会把SIP进行压缩或者加密，然后就交给查询CSCF（I-CSCF），I-CSCF会查询HSS数据，来对用户名和密码进行认证，当然，他也从HSS里查询你是否欠费了，开通或关闭了某些业务，以及你是从哪个P-CSCF来的，用来判断你是不是漫游。
整个呼叫过程中，P-CSCF是不做复杂工作的，P-CSCF只负责接收SIP消息，它相当于是对外联络点，然后SIP消息会到达I-CSCF，I-CSCF是运营商的核心网络——就是运营商内部网络的入口，他会根据HSS查找到用户是属于哪个地区的，会对应分配一个空闲的为该地区服务的服务CSCF（S-CSCF），一直到了这里，S-CSCF才是真正的VoIP里Proxy Server的角色，S-CSCF完成用户注册认证和呼叫的路由处理，以及电话业务的触发（IMS称为AS，另外独立成一个子系统，下述）。
所以如果综合来分析，P-CSCF和I-CSCF只是起到一个边界安全防护SBC服务器和负载平衡、服务器分流这一类功能，真正处理SIP注册和呼叫的原先VoIP里标准逻辑的组件，是S-CSCF，从物理上看，P-CSCF可能是全国或省一级中心统一的服务器集群，配合更多的I-CSCF服务器分布在主干核心网上做分流，背靠一个大的HSS服务器群，将不同市县的用户分配到各地的S-CSCF上进行实际的处理，并且S-CSCF会更多地与当地的通讯机房里原有的2G、3G发生交流，也就是媒体网关（MGW），负责把新的走4G的手机终端和旧的3G、2G以及固定电话之类的对接起来，保持兼容（也就是PS、CS域的互通）。
所以，一个最最精简的IMS系统，它的核心组件是包含HSS、CSCF（P、I、S）即可，即把VoIP SIP的核心Register和Proxy Server进行按运营需求的发展：
▽
MGW
MGW，其实就是市面上大量被使用的VoIP的模拟网关，数字中继网关，而已……当然，运营商对稳定性要求需要更高一些，并且需要额外的集中管理和控制能力；
总结

如果上了4G也只是为了提供和原来类似的语音通话功能，运营商的面子还是挂不住的，得与时俱进，提供一些IM服务，面向个人用户，所以一般还要加一个Presence Server，推送服务器，离线存储服务器等云的概念，提供的，无非是类似qq或微信的功能了，当然，可能是收费的，再次笑而不语……
同样的，通讯不只是面向个人的，也要面向企业，所以上面也提到了AS子系统，即Application Server，其实就是现在的通讯行业内的增值方案服务供应商了，一般就是提供例如电话会议、语音留言，企业语音导航IVR，电话呼入自动分配ACD等等；
因为象4G或者NGN，大家全是跑在IP网络上的，所以就不再需要象原先做电话呼叫中心，CTI系统等等，让电话与电脑信息系统对接需要额外购买一台电话程控交换机、语音板卡等等才能使用的问题了，只要有能接入网络的智能的设备，电脑、手机、平板，都可以直接与IMS的AS子系统对接，这可能才是真正的推4G或ngn的价值吧，让电话也完全融入电脑的IP网络世界里，电话、手机独立在企业的信息化系统外面已经太多年了，如果这一均势发展良好，那些老掉牙的定制的CTI通讯系统，终于可以跟上互联网产品发展的节奏，让我们接触的象银行、快递公司的电话系统，医院的挂号、火车飞车的买票的电话系统，真正的能跟上时代发展的脚步了，IVR语音菜单导航这种逆天反人类的存在，早就该被淘汰了！
-------------------------------------------------------------------------------------------------------------------------------------------------------------

PDN连接与默认 APN
PDN连接

–PDN连接指在UE与一个PLMN外部分组数据网络（PDN）之间，EPS系统提供的IP连接，一个PDN连接可包含多个EPS承载
–PDN连接必须关联UE的IP地址（一个IPv4地址和/或一个IPv6地址前缀），PDN由APN标识
–根据UE的IP地址，可以将PDN连接分为以下三类：
•IPv4
•IPv6
•IPv4v6
–EPS系统支持一个P-GW接入多个PDN，也支持多个P-GW分别接入多个PDN

Default APN（默认APN）
–签约数据中定义的默认APN
–在附着和UE请求PDN连接，并且UE未提供APN时使用

 

 LTE网络是一个只有PS域的全IP的移动网络，没有CS域，因此UE必须连接到至少一个PDN (Packet Data Network) 才能执行数据通信的工作。在EPS系统中，PND指的是外部的数据网络（相对于LTE运营商而言），例如互联网、企业专用网等，使用APN作为PDN的标示。P-GW位于EPC和PDN的边界，EPS Bearer存在于UE和P-GW之间。通常情况下，EPS承载可以看作是UE和P-GW之间的逻辑电路，EPS承载取代了UMTS网络中的PDP。

       在UE的第一条Initial Attach中就包含了附着请求（attach request）和PDN连接请求（PDN connectivity request）， PDN连接请求的目的是会在UE和P-GW之间建立默认承载（default bearer），默认承载会保持连接直到UE分离（detach）LTE网络。

         一般来说，每个PDN连接都对应着一个默认承载（Default Bearer）和一个IP address，只有当UE和PDN都支持IPv4、IPv6双协议栈时，一个PDN连接才有可能对应2个Default Bearer和IP Address，UE在此PDN连接的有效期内将会一直保持此Default Bearer。如果UE存在与多个PDN的连接，那么UE就有多个Default Bearer和IP地址。默认承载的QoS参数可以来自于HHS中获取的签约数据，也可以通过PCRF交互或者基于本地配置来改变这些值。为了给相同IP地址的UE提供不同QoS保障的业务，需要在UE和PDN之间建立一个或多个专有承载（Dedicated EPS Bearer），每个专有承载有自己的QoS，运营商可以根据PCRF（Policy And Charging Resource Function）定义的策略将不同的数据流映射到相应的专有承载上。专有承载的创建或修改只能由网络侧来发起，并且承载的QoS参数总是由核心网来分配。

         PDN连接请求可带参数是APN（可选）、UE支持的PDN类型（IPv4，IPv6，IPv4v6等）、PCO（DNS地址请求）、静态IP（可选）。如果APN为空，就采用缺省APN，缺省APN是由HSS提供的，也就说缺省APN由SIM卡决定。是否支持静态IP也是由采用SIM卡决定的。

         EPS承载不完全等同于UMTS网络中的PDP。相同点是用户数据的传输一定位于某个EPS承载或者PDP上。不同点是：（1）每个PDP都一个IP地址，而EPS承载的IP地址是它所归属的PDN连接的IP地址；（2）EPS承载有QoS的保障，而PDP是没有的。

         EPS系统中，QoS控制的基本粒度是ESP承载（Bearer），即相同承载上的所有数据流将获得相同的QoS保障（如调度策略、缓冲队列管理、链路层配置等），不同的QoS保障需要不同类型的EPS承载来提供。

 

小结：

（1）在LTE网络中，UE在驻网过程中一定会发起PDN连接请求，除非被网络拒绝，否则一定会获得一个IP地址。
（2）默认承载在PDN连接成功后一定会被创建，所有的数据传输都一定归属于某个承载。
（3）归属于同一个PDN连接的同类型承载（IPv4或者IPv6）具有相同的IP地址。
（4）在UE和网络都支持的情况下，可以建立多个PDN连接。
（5）在实际使用中，由于默认PDN连接驻网过程中就发出了，因此，要修改默认PDN的APN，至少需要重启协议栈。